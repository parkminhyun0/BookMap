<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>📖 도서 상세 페이지</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#fafafa; }
    h1 { margin-bottom: 20px; }

    .book-detail {
      max-width: 720px; margin: auto;
      background: #fff; padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .top-meta { margin-bottom: 20px; font-size:14px; color:#555; }
    .row { display: flex; gap: 20px; }
    .cover { width: 150px; height: 210px; object-fit: cover; border-radius: 6px; background:#f2f2f2; }
    .no-cover { width:150px; height:210px; border-radius:6px; background:#f0f0f0;
      display:flex; align-items:center; justify-content:center; color:#888; font-size:12px; }
    .info { flex: 1; }
    h2 { margin: 0 0 10px; font-size:22px; color:#222; }
    .meta { margin: 4px 0; font-size: 15px; color:#666; }
    .reason { margin: 12px 0; font-size: 16px; line-height:1.5; color:#333; }
    .link { display:inline-block; margin-top:10px; padding:8px 14px; background:#1a73e8; color:#fff;
      border-radius:6px; text-decoration:none; font-size:14px; }
    .link:hover { background:#0c5fd3; }
    .source { margin-top: 8px; font-size: 12px; color:#999; }
    .back-btn { display:inline-block; margin-bottom:20px; font-size:14px; text-decoration:none; color:#1a73e8; }
  </style>
</head>
<body>
  <a class="back-btn" href="book.html">← 목록으로 돌아가기</a>
  <div id="book-detail" class="book-detail">불러오는 중...</div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxFb7I_eFXm7nPtkcezalzNRSeJ3Pg5lPM6byRbiEHkF8pXVjReRC_kYKsVD0flABYrQw/exec";
    const params = new URLSearchParams(window.location.search);
    const bookId = parseInt(params.get("id"), 10);

    const esc = (s) => String(s ?? '').replace(/[&<>"']/g, c => (
      { '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]
    ));

    async function loadBookDetail() {
      const container = document.getElementById("book-detail");
      try {
        const res = await fetch(`${API_URL}?action=list&status=승인`);
        const data = await res.json();

        if (!Array.isArray(data) || !data[bookId]) {
          container.textContent = "해당 도서를 찾을 수 없습니다.";
          return;
        }

        const book = data[bookId];

        const coverHTML = book.cover
          ? `<img class="cover" src="${esc(book.cover)}" alt="${esc(book.title)} 표지"/>`
          : `<div class="no-cover">표지 없음</div>`;

        const linkHTML = book.link
          ? `<a class="link" href="${esc(book.link)}" target="_blank" rel="noopener">📖 구매페이지 (${book.link.includes("aladin") ? "알라딘" : book.link.includes("kyobo") ? "교보문고" : "외부"})</a>`
          : `<span class="meta">구매 링크 없음</span>`;

        container.innerHTML = `
          <div class="top-meta">📌 분야: ${esc(book.category)} | 난이도: ${esc(book.level)}</div>
          <div class="row">
            ${coverHTML}
            <div class="info">
              <h2>${esc(book.title)}</h2>
              <div class="meta"><b>저자:</b> ${esc(book.author)}</div>
              <div class="reason">${book.reason ? esc(book.reason) : "설명 없음"}</div>
              ${linkHTML}
              <div class="source">이미지/링크 제공: 알라딘/교보문고</div>
            </div>
          </div>
        `;
      } catch (err) {
        container.textContent = "불러오기 실패: " + err;
      }
    }

    loadBookDetail();
  </script>
</body>
</html>
