<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“‹ ê´€ë¦¬ì í˜ì´ì§€ (ìŠ¹ì¸ / ì‚­ì œ)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">ğŸ“‹ ê´€ë¦¬ì í˜ì´ì§€ (ìŠ¹ì¸ / ì‚­ì œ)</h2>
    <table class="table table-bordered bg-white shadow-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>ì œëª©</th>
          <th>ì €ì</th>
          <th>ì¶œíŒì‚¬</th>
          <th>ìƒíƒœ</th>
          <th>ê´€ë¦¬</th>
        </tr>
      </thead>
      <tbody id="admin-list"></tbody>
    </table>
    <a href="book.html" class="btn btn-secondary">â† ë„ì„œ ëª©ë¡ìœ¼ë¡œ</a>
  </div>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxFb7I_eFXm7nPtkcezalzNRSeJ3Pg5lPM6byRbiEHkF8pXVjReRC_kYKsVD0flABYrQw/exec"; 
  let booksData = [];

  async function loadBooks() {
    const res = await fetch(API_URL);
    booksData = await res.json();

    const tbody = document.getElementById("admin-list");
    tbody.innerHTML = booksData.map((b, i) => `
      <tr>
        <td>${i+1}</td>
        <td>${b.title || '-'}</td>
        <td>${b.author || '-'}</td>
        <td>${b.publisher || '-'}</td>
        <td>${b.status || '-'}</td>
        <td>
          <button class="btn btn-success btn-sm" onclick="approveBook(${b._row})">ìŠ¹ì¸</button>
          <button class="btn btn-danger btn-sm" onclick="deleteBook(${b._row})">ì‚­ì œ</button>
        </td>
      </tr>
    `).join('');
  }

  async function approveBook(row) {
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action:"approve", id:row }),
    });
    const result = await res.json();
    if(result.ok) {
      alert("âœ… ìŠ¹ì¸ ì™„ë£Œ");
      loadBooks();
    } else {
      alert("âŒ ìŠ¹ì¸ ì‹¤íŒ¨: " + result.error);
    }
  }

  async function deleteBook(row) {
    if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action:"delete", id:row }),
    });
    const result = await res.json();
    if(result.ok) {
      alert("ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ");
      loadBooks();
    } else {
      alert("âŒ ì‚­ì œ ì‹¤íŒ¨: " + result.error);
    }
  }

  loadBooks();
  </script>
</body>
</html>
