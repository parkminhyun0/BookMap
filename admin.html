<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>📋 관리자 페이지 (승인 / 삭제)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">📋 관리자 페이지 (승인 / 삭제)</h2>
    <table class="table table-bordered bg-white shadow-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>제목</th>
          <th>저자</th>
          <th>출판사</th>
          <th>상태</th>
          <th>관리</th>
        </tr>
      </thead>
      <tbody id="admin-list"></tbody>
    </table>
    <a href="book.html" class="btn btn-secondary">← 도서 목록으로</a>
  </div>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxFb7I_eFXm7nPtkcezalzNRSeJ3Pg5lPM6byRbiEHkF8pXVjReRC_kYKsVD0flABYrQw/exec"; 
  let booksData = [];

  async function loadBooks() {
    const res = await fetch(API_URL);
    booksData = await res.json();

    const tbody = document.getElementById("admin-list");
    tbody.innerHTML = booksData.map((b, i) => `
      <tr>
        <td>${i+1}</td>
        <td>${b.title || '-'}</td>
        <td>${b.author || '-'}</td>
        <td>${b.publisher || '-'}</td>
        <td>${b.status || '-'}</td>
        <td>
          <button class="btn btn-success btn-sm" onclick="approveBook(${b._row})">승인</button>
          <button class="btn btn-danger btn-sm" onclick="deleteBook(${b._row})">삭제</button>
        </td>
      </tr>
    `).join('');
  }

  async function approveBook(row) {
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action:"approve", id:row }),
    });
    const result = await res.json();
    if(result.ok) {
      alert("✅ 승인 완료");
      loadBooks();
    } else {
      alert("❌ 승인 실패: " + result.error);
    }
  }

  async function deleteBook(row) {
    if (!confirm("정말 삭제하시겠습니까?")) return;
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action:"delete", id:row }),
    });
    const result = await res.json();
    if(result.ok) {
      alert("🗑️ 삭제 완료");
      loadBooks();
    } else {
      alert("❌ 삭제 실패: " + result.error);
    }
  }

  loadBooks();
  </script>
</body>
</html>
