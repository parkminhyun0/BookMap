<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>📚 BookMap 관리자</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">📖 도서 관리 (승인 / 삭제)</h2>
    <div id="book-list" class="table-responsive">
      <p>불러오는 중...</p>
    </div>
  </div>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxFb7I_eFXm7nPtkcezalzNRSeJ3Pg5lPM6byRbiEHkF8pXVjReRC_kYKsVD0flABYrQw/exec";

  async function loadBooks() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0) {
        document.getElementById("book-list").innerHTML = "<p>등록된 도서가 없습니다.</p>";
        return;
      }

      renderTable(data);
    } catch (err) {
      document.getElementById("book-list").innerHTML = `<p class="text-danger">불러오기 실패: ${err}</p>`;
    }
  }

  function renderTable(data) {
    const container = document.getElementById("book-list");
    const rows = data.map((b, i) => `
      <tr>
        <td>${i+1}</td>
        <td>${b.title || "-"}</td>
        <td>${b.author || "-"}</td>
        <td>${b.translator || "-"}</td>
        <td>${b.publisher || "-"}</td>
        <td>${b.category || "-"}</td>
        <td>${b.level || "-"}</td>
        <td>${b.submitter || "-"}</td>
        <td>${b.status || "-"}</td>
        <td>
          <button class="btn btn-sm btn-success me-1" onclick="approveBook(${i})">승인</button>
          <button class="btn btn-sm btn-danger" onclick="deleteBook(${i})">삭제</button>
        </td>
      </tr>
    `).join('');

    container.innerHTML = `
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>#</th>
            <th>제목</th>
            <th>저자</th>
            <th>옮긴이</th>
            <th>출판사</th>
            <th>분류</th>
            <th>난이도</th>
            <th>등록자</th>
            <th>상태</th>
            <th>관리</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    `;
  }

  async function approveBook(id) {
    if (!confirm("이 도서를 승인하시겠습니까?")) return;
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action: "update", id, patch: { status: "승인" } }),
      headers: { "Content-Type": "application/json" }
    });
    alert("승인 완료");
    loadBooks();
  }

  async function deleteBook(id) {
    if (!confirm("이 도서를 삭제하시겠습니까?")) return;
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action: "delete", id }),
      headers: { "Content-Type": "application/json" }
    });
    alert("삭제 완료");
    loadBooks();
  }

  loadBooks();
  </script>
</body>
</html>
