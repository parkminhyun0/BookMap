<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“š BookMap ê´€ë¦¬ì</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">ğŸ“– ë„ì„œ ê´€ë¦¬ (ìŠ¹ì¸ / ì‚­ì œ)</h2>
    <div id="book-list" class="table-responsive">
      <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
  </div>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxFb7I_eFXm7nPtkcezalzNRSeJ3Pg5lPM6byRbiEHkF8pXVjReRC_kYKsVD0flABYrQw/exec";

  async function loadBooks() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0) {
        document.getElementById("book-list").innerHTML = "<p>ë“±ë¡ëœ ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      renderTable(data);
    } catch (err) {
      document.getElementById("book-list").innerHTML = `<p class="text-danger">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${err}</p>`;
    }
  }

  function renderTable(data) {
    const container = document.getElementById("book-list");
    const rows = data.map((b, i) => `
      <tr>
        <td>${i+1}</td>
        <td>${b.title || "-"}</td>
        <td>${b.author || "-"}</td>
        <td>${b.translator || "-"}</td>
        <td>${b.publisher || "-"}</td>
        <td>${b.category || "-"}</td>
        <td>${b.level || "-"}</td>
        <td>${b.submitter || "-"}</td>
        <td>${b.status || "-"}</td>
        <td>
          <button class="btn btn-sm btn-success me-1" onclick="approveBook(${i})">ìŠ¹ì¸</button>
          <button class="btn btn-sm btn-danger" onclick="deleteBook(${i})">ì‚­ì œ</button>
        </td>
      </tr>
    `).join('');

    container.innerHTML = `
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>#</th>
            <th>ì œëª©</th>
            <th>ì €ì</th>
            <th>ì˜®ê¸´ì´</th>
            <th>ì¶œíŒì‚¬</th>
            <th>ë¶„ë¥˜</th>
            <th>ë‚œì´ë„</th>
            <th>ë“±ë¡ì</th>
            <th>ìƒíƒœ</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    `;
  }

  async function approveBook(id) {
    if (!confirm("ì´ ë„ì„œë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action: "update", id, patch: { status: "ìŠ¹ì¸" } }),
      headers: { "Content-Type": "application/json" }
    });
    alert("ìŠ¹ì¸ ì™„ë£Œ");
    loadBooks();
  }

  async function deleteBook(id) {
    if (!confirm("ì´ ë„ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ action: "delete", id }),
      headers: { "Content-Type": "application/json" }
    });
    alert("ì‚­ì œ ì™„ë£Œ");
    loadBooks();
  }

  loadBooks();
  </script>
</body>
</html>
